<?xml version="1.0" encoding="UTF-8"?>
<schema version="4.0.0">
   <!-- license scheme (provided by a plugin identified by "algo_id"), user provides "secret" during scheme creation, other settings at "data" table -->
  <table name="softsale_license_scheme">
      
    <field name="scheme_id" type="int" unsigned="1" notnull="1" extra="auto_increment"/>

    <field name="title" type="varchar" len="255" notnull="1" />
    <field name="comment" type="varchar" len="1024"  />
    <field name="is_disabled" type="tinyint" notnull="1" default="0" />

    <field name="plugin_id" type="varchar" len="64" notnull="1" />
    <field name="keygen_plugin_id" type="varchar" len="64" notnull="1" />
    <field name="activator_plugin_id" type="varchar" len="64" notnull="1" />
    <field name="manualactivator_plugin_id" type="varchar" len="64" notnull="1" />
    
    <field name="activations_allowed" type="int" default="1" notnull="1" /><!-- for each license key -->
    <field name="reactivations_allowed" type="int" default="0" notnull="1" /><!-- total -->
    <field name="local_activation_valid" type="int" default="0" notnull="1" /><!-- "call home" every .. days -->
    
    <field name="local_hash_key" type="varchar" len="8192" notnull="1" />
    <field name="bind_to" type="varchar" len="64" notnull="0" />
    <field name="valid_to" type="varchar" len="255" />
    <field name="email_template" type="varchar" len="255" />
    
    <index name="PRIMARY" unique="1">
      <field name="scheme_id"/>
    </index>
  </table>
  
  <!-- an issued license -->
  <table name="softsale_license">
      
    <field name="license_id" type="int" unsigned="1" notnull="1" extra="auto_increment"/>
    <field name="user_id" type="int" unsigned="1" notnull="1"/>
    <field name="invoice_id" type="int" unsigned="1" notnull="1"/>
    <field name="invoice_item_id" type="int" unsigned="1" notnull="1" />
    <field name="scheme_id" type="int" unsigned="1" notnull="1" />
    <field name="is_disabled" type="tinyint" unsigned="1" notnull="0" default="0" />
    
    <field name="key" type="varchar" len="2048" notnull="1" />
    <field name="info" type="varchar" len="4096" notnull="1" />
    
    <field name="created" type="datetime" />
    <field name="started" type="datetime" />
    <field name="expires" type="datetime" />
    
    
    <index name="PRIMARY" unique="1">
      <field name="license_id"/>
    </index>
    <index name="user" unique="0">
      <field name="user_id"/>
    </index>
    <index name="key" unique="1">
      <field name="key" len="128" />
    </index>
  </table>
  
  <table name="softsale_license_scheme_product">
    <field name="scheme_product_id" type="int" unsigned="1" notnull="1" extra="auto_increment" />
    <field name="scheme_id" type="int" unsigned="1" notnull="1"/>
    <field name="product_id" type="int" unsigned="1" notnull="1"/>
    <index name="PRIMARY" unique="1">
      <field name="scheme_product_id"/>
    </index>
    <index name="product_scheme" unique="1">
      <field name="product_id"/>
      <field name="scheme_id"/>
    </index>
  </table>
  
  <table name="softsale_license_activation">
    <field name="license_activation_id" type="int" unsigned="1" notnull="1" extra="auto_increment" />
    <field name="license_id" type="int" unsigned="1" notnull="1" />
    <field name="dattm" type="datetime" />
    <field name="request" type="varchar" len="1024" notnull="1" /><!-- information on host, url, user machine id, etc. -->
    <field name="code" type="varchar" len="8192" notnull="1" /><!-- generated by activation plugin -->
    <field name="is_disabled" type="tinyint" unsigned="0" notnull="1" default="0" />
    <field name="disabled_dattm" type="datetime" notnull="0" />
    <index name="PRIMARY" unique="1">
      <field name="license_activation_id"/>
    </index>
  </table>
  
  <table name="softsale_license_log">
      <field name="license_log_id"  type="int" unsigned="1" notnull="1" extra="auto_increment" />
      <field name="dattm" type="datetime" />
      <field name="ip" type="varchar" len="32" />
      <field name="user_id" type="int" />
      <field name="admin_id" type="int" />
      <field name="key" type="varchar" len="1024" />
      <field name="event" type="varchar" len="255" />
      <field name="info" type="varchar" len="1024" />
      
      <index name="PRIMARY" unique="1">
        <field name="license_log_id"/>
      </index>
  </table>
  
  <table name="softsale_file">
      <field name="file_id" type="int" unsigned="1" notnull="1" extra="auto_increment" />
      <field name="title" type="varchar" len="255" notnull="1" />
      <field name="desc" type="varchar" len="255" notnull="1" />
      <field name="hide" type="tinyint" notnull="1" default="0" />
      <field name="sort" type="int" />
      <index name="PRIMARY" unique="1">
        <field name="file_id"/>
      </index>
  </table>

  <table name="softsale_file_upload">
      <field name="file_upload_id" type="int" unsigned="1" notnull="1" extra="auto_increment" />
      <field name="file_id" type="int" unsigned="1" notnull="1" />
      <field name="version" type="varchar" len="32" />
      <field name="desc" type="varchar" len="255" />
      <field name="details" type="text" />
      <field name="path" type="varchar" len="255" />
      <field name="mime" type="varchar" len="64" />
      <field name="size" type="int" />
      <field name="hide" type="tinyint" notnull="1" default="0" />
      <field name="date" type="date" />
      <index name="PRIMARY" unique="1">
        <field name="file_upload_id"/>
      </index>
      <index name="file_version" unique="1">
        <field name="file_id" />
        <field name="version" />
      </index>
  </table>
      
<!--
  <table name="user" comment="here we show how to insert new field into am_user table">
      <field name="example_user_field" type="varchar" len="255" />
  </table>
-->
</schema>
